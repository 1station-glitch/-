<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© --- */
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('bg.png');
            background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed;
            min-height: 100vh; min-height: 100dvh; 
            display: flex; justify-content: center; align-items: center;
            margin: 0; padding: 15px;
        }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .register-card { 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px);
            padding: 25px 20px; width: 100%; max-width: 380px;
            border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            text-align: center; 
        }
        
        .register-card h2 { margin-top: 0; margin-bottom: 20px; color: #1f2937; font-size: 22px; font-weight: 800; }
        
        .input-group { margin-bottom: 12px; text-align: right; }
        .input-group label { display: block; margin-bottom: 6px; color: #374151; font-size: 13px; font-weight: 700; }
        
        input { 
            width: 100%; padding: 12px 14px; border: 1px solid #d1d5db; 
            border-radius: 10px; outline: none; transition: 0.3s; 
            font-size: 16px; background-color: #f9fafb;
        }
        input:focus { border-color: #3b82f6; background-color: #fff; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15); }

        /* --- ØªØµÙ…ÙŠÙ… Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (Ø¬Ø¯ÙŠØ¯) --- */
        .terms-container {
            display: flex; align-items: center; gap: 10px;
            margin-top: 15px; margin-bottom: 15px;
            font-size: 13px; color: #4b5563; font-weight: 600;
            text-align: right;
        }
        .terms-container input[type="checkbox"] {
            width: 18px; height: 18px; accent-color: #3b82f6; cursor: pointer;
        }
        .terms-link {
            color: #3b82f6; text-decoration: underline; cursor: pointer; font-weight: bold;
        }

        /* Ø§Ù„Ø²Ø± */
        button { 
            width: 100%; padding: 14px; background-color: #3b82f6; 
            color: white; border: none; border-radius: 10px; cursor: pointer; 
            font-size: 16px; font-weight: 700; transition: 0.2s;
        }
        button:hover { background-color: #2563eb; }
        button:disabled { background-color: #9ca3af; cursor: not-allowed; }

        .login-link-container { margin-top: 20px; font-size: 14px; color: #4b5563; }
        .login-link-container a { color: #3b82f6; text-decoration: none; font-weight: bold; }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª + Ø§Ù„Ø³ÙŠØ§Ø³Ø©) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); display: none;
            justify-content: center; align-items: center; z-index: 2000;
            backdrop-filter: blur(2px);
        }
        
        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠ */
        .modal-box {
            background: white; padding: 25px; border-radius: 16px;
            width: 85%; max-width: 320px; text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.3s ease-out;
        }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© (Ù…Ø®ØµØµ Ù„ÙŠÙ‚Ø¨Ù„ Ø³ÙƒØ±ÙˆÙ„) */
        .policy-box {
            background: white; border-radius: 16px;
            width: 90%; max-width: 400px; height: 80%; /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ø­Ø¯Ø¯ */
            display: flex; flex-direction: column;
            overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù† Ø§Ù„Ø¥Ø·Ø§Ø± */
            animation: fadeIn 0.3s ease-out;
        }
        .policy-header {
            padding: 20px; border-bottom: 1px solid #e5e7eb;
            font-weight: bold; font-size: 18px; color: #1f2937;
            display: flex; justify-content: space-between; align-items: center;
        }
        .policy-content {
            padding: 20px; overflow-y: auto; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù„Ù„Ù†Øµ ÙÙ‚Ø· */
            text-align: right; font-size: 14px; line-height: 1.6; color: #4b5563;
            flex: 1;
        }
        .policy-footer {
            padding: 15px; border-top: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .modal-icon { font-size: 40px; margin-bottom: 10px; }
        .modal-title { font-size: 18px; font-weight: bold; color: #1f2937; margin-bottom: 8px; }
        .modal-text { color: #6b7280; margin-bottom: 20px; font-size: 14px; }
        .modal-btn { background-color: #3b82f6; color: white; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; width: 100%; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div class="register-card">
        <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
        
        <div class="input-group">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input type="text" id="fullName" placeholder="Ù…Ø«Ø§Ù„: ØµØ§Ù„Ø­ Ù…Ø­Ù…Ø¯" required>
        </div>
        <div class="input-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
            <input type="tel" id="phone" placeholder="05xxxxxxxx" required>
        </div>
        <div class="input-group">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="email" placeholder="example@mail.com" required>
        </div>
        <div class="input-group">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="password" placeholder="********" required>
        </div>

        <div class="terms-container">
            <input type="checkbox" id="termsCheckbox">
            <label for="termsCheckbox">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <span id="openPrivacyBtn" class="terms-link">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</span></label>
        </div>

        <button id="registerBtn">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</button>
        
        <div class="login-link-container">
            Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="login.html">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù‡Ù†Ø§</a>
        </div>
    </div>

    <div id="customModal" class="modal-overlay">
        <div class="modal-box">
            <div id="modalIcon" class="modal-icon">ğŸ‰</div>
            <h3 id="modalTitle" class="modal-title">Ø¹Ù†ÙˆØ§Ù†</h3>
            <p id="modalMessage" class="modal-text">Ù†Øµ</p>
            <button id="modalBtn" class="modal-btn">ÙÙ‡Ù…Øª</button>
        </div>
    </div>

    <div id="privacyModal" class="modal-overlay">
        <div class="policy-box">
            <div class="policy-header">
                <span>ğŸ“„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
                <span id="closePrivacyX" style="cursor:pointer; font-size: 20px;">&times;</span>
            </div>
            <div class="policy-content">
                <p><strong>1. Ù…Ù‚Ø¯Ù…Ø©</strong><br>Ù†Ø±Ø­Ø¨ Ø¨ÙƒÙ… ÙÙŠ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§. ØªÙ†Ø·Ø¨Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù…ÙˆÙ‚Ø¹Ù†Ø§ ÙˆØ®Ø¯Ù…Ø§ØªÙ†Ø§.</p>
                <br>
                <p><strong>2. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</strong><br>Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªÙ‚Ø¯Ù…Ù‡Ø§ Ù„Ù†Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø«Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØºØ±Ø¶ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ.</p>
                <br>
                <p><strong>3. Ø§Ù„Ø£Ù…Ø§Ù†</strong><br>Ù†Ø­Ù† Ù†Ù„ØªØ²Ù… Ø¨Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙ†Ø³ØªØ®Ø¯Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø£Ù…Ø§Ù† Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡.</p>
                <br>
                <p><strong>4. Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong><br>Ø£Ù†Øª Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ø±ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ.</p>
                <br>
                <p><strong>5. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</strong><br>Ù†Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø­Ù‚ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙÙŠ Ø£ÙŠ ÙˆÙ‚ØªØŒ ÙˆØ³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø±ÙƒÙ… Ø¨Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ø¬ÙˆÙ‡Ø±ÙŠØ©.</p>
                <br>
                <p>Ù†Ø±Ø¬Ùˆ Ù‚Ø±Ø§Ø¡Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø¹Ù†Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.</p>
            </div>
            <div class="policy-footer">
                <button id="closePrivacyBtn" class="modal-btn" style="background: #4b5563;">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ğŸ”´ğŸ”´ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ ğŸ”´ğŸ”´
         const firebaseConfig = {
           apiKey: "AIzaSyDuzHaoq7AgzahbqB0Ud5YWL3B3y__wJi4",
           authDomain: "my-dashboard-d7e5f.firebaseapp.com",
           projectId: "my-dashboard-d7e5f",
           storageBucket: "my-dashboard-d7e5f.firebasestorage.app",
           messagingSenderId: "33578225090",
           appId: "1:33578225090:web:b6b339bd56dfde1a9f5a5b"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ---
        const modal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalIcon = document.getElementById('modalIcon');
        const modalBtn = document.getElementById('modalBtn');
        let redirectUrl = null;

        function showModal(title, message, icon, url = null) {
            modalTitle.innerText = title;
            modalMessage.innerText = message;
            modalIcon.innerText = icon;
            redirectUrl = url;
            modal.style.display = "flex";
        }
        modalBtn.addEventListener('click', () => {
            modal.style.display = "none";
            if (redirectUrl) window.location.href = redirectUrl;
        });

        // --- Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…ÙˆØ¯Ø§Ù„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© ---
        const privacyModal = document.getElementById('privacyModal');
        const openPrivacyBtn = document.getElementById('openPrivacyBtn');
        const closePrivacyBtn = document.getElementById('closePrivacyBtn');
        const closePrivacyX = document.getElementById('closePrivacyX');

        // ÙØªØ­ Ø§Ù„Ø³ÙŠØ§Ø³Ø©
        openPrivacyBtn.addEventListener('click', () => {
            privacyModal.style.display = "flex";
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³ÙŠØ§Ø³Ø©
        const closePrivacy = () => privacyModal.style.display = "none";
        closePrivacyBtn.addEventListener('click', closePrivacy);
        closePrivacyX.addEventListener('click', closePrivacy);


        // --- Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ---
        document.getElementById('registerBtn').addEventListener('click', async () => {
            const fullName = document.getElementById('fullName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const termsCheckbox = document.getElementById('termsCheckbox'); // Ø¹Ù†ØµØ± Ø§Ù„Ø´ÙŠÙƒ Ø¨ÙˆÙƒØ³
            const btn = document.getElementById('registerBtn');

            // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·
            if (!termsCheckbox.checked) {
                showModal("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„.", "âš ï¸");
                return;
            }

            if(!fullName || !phone || !email || !password) {
                showModal("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.", "â„¹ï¸");
                return;
            }

            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
            btn.disabled = true;

            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¬ÙˆØ§Ù„
                const usersRef = collection(db, "users");
                const q = query(usersRef, where("phone", "==", phone));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) throw new Error("phone-exists");

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
                btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...";
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await setDoc(doc(db, "users", user.uid), {
                    fullName: fullName, 
                    phone: phone, 
                    email: email, 
                    createdAt: new Date(),
                    termsAccepted: true // Ø­ÙØ¸ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§ÙÙ‚
                });

                showModal("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„", `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ${fullName}ØŒ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!`, "ğŸ‰", "index.html");

            } catch (error) {
                btn.innerText = "ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨";
                btn.disabled = false;
                
                let message = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.";
                if (error.message == "phone-exists") message = "Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹.";
                else if(error.code == 'auth/email-already-in-use') message = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„.";
                else if (error.code == 'auth/weak-password') message = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©.";
                else if (error.code == 'auth/invalid-email') message = "ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
                
                showModal("Ø®Ø·Ø£", message, "âš ï¸");
            }
        });
    </script>
</body>
</html>