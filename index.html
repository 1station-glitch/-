<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - 1STATION</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    <style>
        /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© --- */
        :root { --primary: #3b82f6; --bg: #f3f4f6; --sidebar: #1e293b; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; }
        
        /* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© --- */
        .sidebar { 
            position: fixed; top: 0; 
            right: -220px; 
            width: 220px; 
            height: 100%; 
            background-color: var(--sidebar); color: #fff; 
            padding: 10px; z-index: 1000; transition: 0.3s ease-in-out;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            overflow-y: auto;
        }
        .sidebar.active { right: 0; }

        .sidebar-user-area { text-align: center; padding: 25px 0 15px 0; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-avatar { width: 70px; height: 70px; border-radius: 50%; border: 3px solid #3b82f6; margin-bottom: 10px; object-fit: cover; background-color: #fff; padding: 2px; }
        #sidebarUserName { color: #fff; font-size: 15px; font-weight: 700; display: block; margin-bottom: 2px; }
        .view-profile-text { color: #94a3b8; font-size: 11px; }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        .sidebar-overlay.active { display: block; }

        /* --- Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --- */
        .sidebar-menu { list-style: none; margin-top: 5px; }
        .sidebar-menu li { margin-bottom: 5px; }
        .sidebar-menu a { display: flex; align-items: center; gap: 10px; padding: 10px 12px; color: #cbd5e1; text-decoration: none; border-radius: 8px; transition: all 0.3s ease; font-size: 14px; font-weight: 600; cursor: pointer; }
        .sidebar-menu a:hover, .sidebar-menu a.active { background-color: rgba(255, 255, 255, 0.1); color: #fff; }
        .special-link { background: linear-gradient(45deg, #3b82f6, #2563eb); color: white !important; margin-top: 20px; }

        /* --- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */
        .main-content { flex: 1; display: flex; flex-direction: column; width: 100%; overflow-y: auto; transition: 0.3s; }
        .top-header { background-color: #ffffff; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.03); position: sticky; top: 0; z-index: 500; }
        .menu-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #1e293b; padding: 5px; }
        .btn-logout { background-color: #fee2e2; color: #ef4444; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; }

        /* --- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª) --- */
        .content-section { display: none; padding: 20px 15px; width: 100%; animation: fadeIn 0.4s ease; }
        .content-section.active-section { display: block; }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª) --- */
        .dashboard-title { text-align: center; font-size: 1.6rem; font-weight: 800; margin-bottom: 25px; background: linear-gradient(45deg, #1e293b, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stats-container { display: flex; flex-direction: column; gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); border-bottom: 4px solid #3b82f6; }
        .stat-value { font-size: 24px; font-weight: 800; color: #1f2937; margin-top: 5px; }

        /* --- Ø³ØªØ§ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø´Ø­Ù† (Ù…Ø¯Ù…Ø¬) --- */
        .form-container { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 14px; }
        
        /* ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø®Ø§Ù†Ø§Øª */
        input, select, .select2-container .select2-selection--single { 
            width: 100% !important; height: 50px !important; padding: 0 15px; border-radius: 12px !important; 
            border: 1px solid #ccc !important; font-size: 14px !important; background-color: #fff !important; 
            box-sizing: border-box; display: flex !important; align-items: center !important;
        }
        
        /* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
        .submit-btn { width: 100%; padding: 15px; border-radius: 12px; border: none; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 20px; background: linear-gradient(135deg, #6c63ff, #3f3d56); color: white; }
        
        /* Select2 Tweak */
        .select2-container { width: 100% !important; }
        .select2-container .select2-selection--single .select2-selection__arrow { height: 100% !important; top: 0 !important; left: 10px !important; }
        .select2-container .select2-selection--single .select2-selection__rendered { padding-right: 0 !important; padding-left: 20px !important; color: #333 !important; }

        /* Ø±Ø³Ø§Ø¦Ù„ ÙˆÙ…ÙˆØ¯Ø§Ù„Ø§Øª */
        .note, .warning { width: 100%; padding: 10px; border-radius: 10px; font-size: 13px; display: none; text-align: center; margin-top: 10px; }
        .note { background: #e0f7fa; border: 1px solid #00acc1; color: #006064; }
        .warning { background: #ffebee; border: 1px solid #d32f2f; color: #b71c1c; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; }
        
        /* ØµÙˆØ± Ø§Ù„Ø´Ø±ÙƒØ§Øª */
        .company-images { display:flex; justify-content:center; gap:15px; margin-top:15px; flex-wrap:wrap;}
        .company-images img { width:80px; height:80px; border-radius:12px; border:2px solid #6c63ff; cursor:pointer; object-fit: contain; padding: 5px; background: #fff;}
        .shipping-option { border: 2px solid #6c63ff; border-radius: 15px; padding: 15px; margin: 10px 0; cursor:pointer; display: flex; align-items: center; justify-content: center; gap: 10px;}
        .shipping-option:hover, .shipping-option.selected { background: #6c63ff; color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 992px) {
            body { flex-direction: row; }
            .sidebar { position: static; width: 250px; transform: none; box-shadow: none; right: auto; }
            .sidebar-overlay, .menu-btn { display: none; }
            .content-section { padding: 40px; }
            .stats-container { display: grid; grid-template-columns: repeat(3, 1fr); }
            .dashboard-title { font-size: 3rem; }
        }
    </style>
</head>
<body>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-user-area">
            <a href="#" onclick="showSection('settings-section')" class="profile-link">
                <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="sidebar-avatar" id="sidebarAvatar" alt="Profile">
                <div class="sidebar-user-info">
                    <span id="sidebarUserName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    <span class="view-profile-text">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
                </div>
            </a>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="#" onclick="showSection('dashboard-section')" id="link-dashboard" class="active">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
            <li><a href="#" onclick="showSection('order-section')" id="link-order">ğŸ“„ Ø§ØµØ¯Ø§Ø± Ø¨ÙˆÙ„ÙŠØµØ©</a></li>
            <li><a href="#" onclick="showSection('companies-section')" id="link-companies">ğŸšš Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø´Ø­Ù†</a></li>
            <li><a href="#" onclick="showSection('myorders-section')" id="link-myorders">ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
            <li><a href="#" onclick="showSection('wallet-section')" id="link-wallet">ğŸ’³ Ø§Ù„Ù…Ø­ÙØ¸Ø©</a></li>
            <li><a href="#" onclick="showSection('settings-section')" id="link-settings">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
            <li><a href="store_register.html" class="special-link">ğŸª Ø³Ø¬Ù„ ÙƒÙ…ØªØ¬Ø±</a></li>
        </ul>
    </aside>

    <main class="main-content">
        
        <header class="top-header">
            <button class="menu-btn" id="menuBtn">â˜°</button>
            <div class="header-actions">
                <button class="btn-logout" id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div id="dashboard-section" class="content-section active-section">
            <h1 class="dashboard-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</div>
                    <div class="stat-value" id="userPhoneDisplay">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                    <div class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                    <div class="stat-value" style="font-size: 20px; color: green;">Ù†Ø´Ø·</div>
                </div>
            </div>
        </div>

        <div id="order-section" class="content-section">
            <h2 class="dashboard-title">Ø¥ØµØ¯Ø§Ø± Ø¨ÙˆÙ„ÙŠØµØ© Ø´Ø­Ù†</h2>
            
            <div class="form-container">
                <form id="shippingForm" action="https://formspree.io/f/mlgrgjgp" method="POST" target="_blank">
                    
                    <h3>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</h3>
                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø³Ù…</label>
                        <input type="text" name="store_name" required placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø³Ø¬Ù„">
                    </div>

                    <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø³Ù…</label>
                        <input type="text" name="receiver_name" required>
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" name="receiver_phone" pattern="[0-9]*" inputmode="numeric" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                        <select id="city_select" name="city" required style="width: 100%;">
                            <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ù†...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„Ø­ÙŠ</label>
                        <input type="text" name="receiver_district" required>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ø§Ø±Ø¹</label>
                        <input type="text" name="receiver_street" required>
                    </div>

                    <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø­Ù†Ø©</h3>
                    <div class="form-group">
                        <label>ÙˆØ²Ù† Ø§Ù„Ø´Ø­Ù†Ø© (ÙƒØ¬Ù…)</label>
                        <input type="number" id="weight" name="weight" min="1" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø±ÙŠØ§Ù„)</label>
                        <input type="number" name="value" required>
                    </div>
                    <div class="form-group">
                        <label>Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†</label>
                        <input type="text" id="shippingCompany" name="company" required readonly placeholder="Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±" style="cursor: pointer; background-color: #f9fafb;">
                    </div>

                    <div id="priceNote" class="note" style="font-weight: bold; font-size: 16px; color: #2e7d32; border-color: #2e7d32; background: #e8f5e9;"></div>
                    <div id="weightWarning" class="warning">ğŸš¨ Ø§Ù„ÙˆØ²Ù† ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ø´Ø±ÙƒØ© Ø±ÙŠØ¯ Ø¨ÙˆÙƒØ³!</div>
                    <div id="redboxNote" class="note">â„¹ï¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ³ØªÙ„Ù… Ø§Ù„Ø´Ø­Ù†Ø© Ù…Ù† Ø£Ù‚Ø±Ø¨ Ø®Ø²Ø§Ù†Ø© (RedBox)</div>
                    <div id="brolloNote" class="note">
                        ğŸ“¦ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: 3 Ø´Ø­Ù†Ø§Øª<br>
                        <span style="color:#0066cc; cursor:pointer; text-decoration:underline;" onclick="showBranches()">ğŸ“ Ø¹Ø±Ø¶ ÙØ±ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…</span>
                    </div>

                    <button type="submit" class="submit-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
                </form>
            </div>
        </div>

        <div id="companies-section" class="content-section"><h2 class="dashboard-title">Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø´Ø­Ù†</h2><p style="text-align:center;">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p></div>
        <div id="myorders-section" class="content-section"><h2 class="dashboard-title">Ø·Ù„Ø¨Ø§ØªÙŠ</h2><p style="text-align:center;">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p></div>
        <div id="wallet-section" class="content-section"><h2 class="dashboard-title">Ø§Ù„Ù…Ø­ÙØ¸Ø©</h2><p style="text-align:center;">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p></div>
        <div id="settings-section" class="content-section"><h2 class="dashboard-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2><p style="text-align:center;">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p></div>

    </main>

    <div id="shippingTypeModal" class="modal-overlay">
        <div class="modal-box">
            <h3>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù†</h3>
            <div class="shipping-option" onclick="showCompanyOptions('dry')">
                <span>ğŸ“¦</span> <span>Ø´Ø­Ù† Ø¬Ø§Ù (Ø¹Ø§Ø¯ÙŠ)</span>
            </div>
            <div class="shipping-option" onclick="showCompanyOptions('cold')">
                <span>â„ï¸</span> <span>Ø´Ø­Ù† Ù…Ø¨Ø±Ø¯</span>
            </div>
            <div class="shipping-option" onclick="showCompanyOptions('pickup')">
                <span>ğŸª</span> <span>Ø®Ø²Ø§Ù†Ø§Øª Ø°ÙƒÙŠØ©</span>
            </div>
            
            <div id="companyOptions" style="display:none; margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                <p style="font-size:12px; color:#666;">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙƒØ©:</p>
                <div class="company-images" id="companyButtons"></div>
            </div>
            <button onclick="document.getElementById('shippingTypeModal').style.display='none'" style="margin-top:15px; background:none; border:none; color:red; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="aramexWarningModal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:#d32f2f;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù… â€“ Ø£Ø±Ø§Ù…ÙƒØ³</h3>
            <p style="text-align:right; font-size:14px; line-height:1.6;">
                ÙŠØ±Ø¬Ù‰ ØªØºÙ„ÙŠÙ Ø§Ù„Ø´Ø­Ù†Ø© Ø¬ÙŠØ¯Ù‹Ø§ ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙˆÙ„ÙŠØµØ©.<br>
                Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„: Ø§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø®Ù…ÙŠØ³ 8:30Øµ - 4:30Ù….
            </p>
            <button onclick="confirmAramexWarning()" style="width:100%; padding:10px; background:#d32f2f; color:white; border:none; border-radius:8px; margin-top:10px;">ÙÙ‡Ù…Øª â€“ Ù…ØªØ§Ø¨Ø¹Ø©</button>
        </div>
    </div>

    <div id="branchesModal" class="modal-overlay">
        <div class="modal-box">
            <h3>ÙØ±ÙˆØ¹ Ø¨Ø±ÙˆÙ„Ùˆ</h3>
            <ul style="list-style:none; padding:0; text-align:right;">
                <li>ğŸ“ Ø§Ù„Ø±ÙŠØ§Ø¶</li><li>ğŸ“ Ø¬Ø¯Ø©</li><li>ğŸ“ Ø§Ù„Ø¯Ù…Ø§Ù…</li>
            </ul>
            <button onclick="document.getElementById('branchesModal').style.display='none'" style="margin-top:10px; width:100%; padding:10px; border:none; background:#eee; border-radius:8px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="thankYouModal" class="modal-overlay">
        <div class="modal-box">
            <div style="font-size:50px;">ğŸ‰</div>
            <p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
            <button onclick="document.getElementById('thankYouModal').style.display='none'" style="width:100%; padding:10px; background:#3b82f6; color:white; border:none; border-radius:8px; margin-top:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script type="module">
        // Firebase Setup
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDuzHaoq7AgzahbqB0Ud5YWL3B3y__wJi4",
            authDomain: "my-dashboard-d7e5f.firebaseapp.com",
            projectId: "my-dashboard-d7e5f",
            storageBucket: "my-dashboard-d7e5f.firebasestorage.app",
            messagingSenderId: "33578225090",
            appId: "1:33578225090:web:b6b339bd56dfde1a9f5a5b"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        onAuthStateChanged(auth, async (user) => {
            const sidebarUserName = document.getElementById('sidebarUserName');
            const userPhoneDisplay = document.getElementById('userPhoneDisplay');

            if (user) {
                const docRef = doc(db, "users", user.uid);
                try {
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        if(sidebarUserName) sidebarUserName.innerText = data.fullName;
                        if(userPhoneDisplay) userPhoneDisplay.innerText = data.phone;
                    } else {
                        if(sidebarUserName) sidebarUserName.innerText = "Ù…Ø³ØªØ®Ø¯Ù…";
                    }
                } catch(e) {
                    if(sidebarUserName) sidebarUserName.innerText = user.email ? user.email.split('@')[0] : "Ù…Ø³ØªØ®Ø¯Ù…";
                }
            } else {
                window.location.href = "login.html"; // ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„Ø§Ù‹
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => window.location.href = "login.html");
        });
    </script>

    <script>
        // --- 1. Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª (Ø¨Ø¯ÙˆÙ† ØªØ­Ù…ÙŠÙ„) ---
        function showSection(sectionId) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active-section');
            });
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(sectionId).classList.add('active-section');

            // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø´Ø·
            document.querySelectorAll('.sidebar-menu a').forEach(link => link.classList.remove('active'));
            let activeLink = document.querySelector(`.sidebar-menu a[onclick="showSection('${sectionId}')"]`);
            if(activeLink) activeLink.classList.add('active');

            // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Select2 Ø¹Ù†Ø¯ Ø§Ù„Ø¸Ù‡ÙˆØ±
            if(sectionId === 'order-section') {
                $('#city_select').select2({ dir: "rtl", placeholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...", width: '100%' });
            }
        }

        // Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
        document.getElementById('menuBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.add('active');
            document.getElementById('sidebarOverlay').classList.add('active');
        });
        document.getElementById('sidebarOverlay').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
        });

        // --- 2. Ø³ÙƒØ±Ø¨Øª Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø´Ø­Ù† (Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ù†) ---
        document.addEventListener("DOMContentLoaded", function() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ù†
            const citySelect = document.getElementById('city_select');
            fetch('https://1station-glitch.github.io/-/cities.json?v=' + new Date().getTime()) 
                .then(response => response.text())
                .then(textData => {
                    citySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...</option>';
                    let allLines = textData.split('\n');
                    allLines.forEach(line => {
                        let cleanName = line.replace(/[",\[\]]/g, "").trim();
                        if (cleanName.length > 0) {
                            let option = document.createElement('option');
                            option.value = cleanName;
                            option.textContent = cleanName;
                            citySelect.appendChild(option);
                        }
                    });
                    // ØªÙØ¹ÙŠÙ„ Select2
                    $('#city_select').select2({ dir: "rtl", placeholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...", width: '100%' });
                });

            // Ù…Ù†Ø·Ù‚ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª
            const weightInput = document.getElementById("weight");
            const companyInput = document.getElementById("shippingCompany");
            const priceNote = document.getElementById("priceNote");
            const weightWarning = document.getElementById("weightWarning");
            const redboxNote = document.getElementById("redboxNote");
            const brolloNote = document.getElementById("brolloNote");
            const modal = document.getElementById("thankYouModal");
            const form = document.getElementById("shippingForm");

            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª
            companyInput.addEventListener('click', function() {
                document.getElementById('shippingTypeModal').style.display = 'flex';
                document.getElementById('companyOptions').style.display = 'none';
            });

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±
            function updatePriceNote() {
                const weight = Number(weightInput.value);
                const company = companyInput.value;
                priceNote.style.display = "none";
                weightWarning.style.display = "none";
                redboxNote.style.display = "none";
                brolloNote.style.display = "none";

                if (!weight || !company) return;
                let price = 0;

                if (company === "redbox") {
                    redboxNote.style.display = "block";
                    if (weight > 15) weightWarning.style.display = "block";
                    else price = 17;
                }
                if (company === "aramex") price = weight <= 15 ? 23 : 23 + ((weight-15)*2);
                if (company === "prolo") {
                    brolloNote.style.display = "block";
                    price = weight <= 15 ? 25 : 25 + ((weight-15)*2);
                }

                if (price > 0) {
                    priceNote.innerHTML = `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${price} Ø±ÙŠØ§Ù„`;
                    priceNote.style.display = "block";
                }
            }

            weightInput.addEventListener("input", updatePriceNote);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            form.addEventListener("submit", function(e){
                e.preventDefault();
                const weight = Number(weightInput.value);
                const company = companyInput.value;
                if(company === "redbox" && weight > 15){
                    alert("ÙˆØ²Ù† Ø§Ù„Ø´Ø­Ù†Ø© ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ø±ÙŠØ¯ Ø¨ÙˆÙƒØ³");
                    return;
                }
                modal.style.display = "flex";
                setTimeout(() => { form.submit(); }, 2000);
            });
        });

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù„Ù…ÙŠØ© (Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚)
        let pendingCompany = null;
        window.showCompanyOptions = function(type) {
            const companyButtons = document.getElementById('companyButtons');
            const companyOptions = document.getElementById('companyOptions');
            companyOptions.style.display = 'block';
            companyButtons.innerHTML = '';
            
            if(type === 'dry') addCompanyBtn('aramex.png', 'aramex');
            if(type === 'cold') addCompanyBtn('prolo.png', 'prolo');
            if(type === 'pickup') addCompanyBtn('redbox.png', 'redbox');
        }

        function addCompanyBtn(imgSrc, value) {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.style.width = "80px"; img.style.height = "80px"; img.style.objectFit = "contain";
            img.style.border = "2px solid #6c63ff"; img.style.borderRadius = "10px"; img.style.margin = "5px"; img.style.cursor = "pointer";
            img.onclick = () => selectCompany(value);
            document.getElementById('companyButtons').appendChild(img);
        }

        window.selectCompany = function(company) {
            if(company === "aramex"){
                pendingCompany = "aramex";
                document.getElementById('shippingTypeModal').style.display = 'none';
                document.getElementById("aramexWarningModal").style.display = "flex";
                return;
            }
            document.getElementById("shippingCompany").value = company;
            document.getElementById('shippingTypeModal').style.display = 'none';
            // Ù†Ø­ØªØ§Ø¬ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙŠØ¯ÙˆÙŠØ§Ù‹
            document.getElementById("weight").dispatchEvent(new Event('input'));
        }

        window.confirmAramexWarning = function() {
            document.getElementById("shippingCompany").value = pendingCompany;
            document.getElementById("aramexWarningModal").style.display = "none";
            document.getElementById("weight").dispatchEvent(new Event('input'));
        }
        
        window.showBranches = function() {
            document.getElementById('branchesModal').style.display = 'flex';
        }
    </script>
</body>
</html>
